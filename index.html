<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>JQueryOAuth by ettoavi</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">JQueryOAuth</h1>
      <h2 class="project-tagline">jQuery OAuth</h2>
      <a href="https://github.com/ettoavi/jQueryOAuth" class="btn">View on GitHub</a>
      <a href="https://github.com/ettoavi/jQueryOAuth/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/ettoavi/jQueryOAuth/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <h1>
<a id="jqueryoauth" class="anchor" href="#jqueryoauth" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>jQueryOAuth</h1>

<h1></h1>

<p>A $.ajax wrapper for OAuth 2 access and refresh token management for use in a SPA.</p>

<h1>
<a id="what" class="anchor" href="#what" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>What</h1>

<p>This is a library for storing access token client side and use it for $.ajax requests. Secondly, it is a library for
requesting new access tokens upon expiration.</p>

<h1>
<a id="guide" class="anchor" href="#guide" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Guide</h1>

<p>I have written an extensive blog post about writing a web app using Lumen that utilizes this library for client side 
management of tokens.</p>

<p><a href="http://esbenp.github.io/2015/05/26/lumen-web-api-oauth-2-authentication/">Building a web app with Lumen web API and OAuth2 authentication</a></p>

<h1>
<a id="dependencies" class="anchor" href="#dependencies" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Dependencies</h1>

<ul>
<li>
<a href="https://github.com/jquery/jquery">jQuery</a> 1.5+</li>
<li>
<a href="https://github.com/marcuswestin/store.js">store.js</a> 1.3.17</li>
</ul>

<h1>
<a id="features" class="anchor" href="#features" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Features</h1>

<ul>
<li>Stores access token client side using store.js for persistence between refreshes</li>
<li>Adds authorization header to ajax requests</li>
<li>Adds CSRF token to header requests if provided to protect access token</li>
<li>When access token expires all 401 requests are buffered and fired after a new access token is generated by using
refresh token server side</li>
<li>Works with AMD modules</li>
</ul>

<h1>
<a id="installation" class="anchor" href="#installation" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Installation</h1>

<p>Can be installed via bower package</p>

<pre><code>bower install --save jquery-oauth
</code></pre>

<p>... or by cloning the repository</p>

<pre><code>git clone git@github.com:esbenp/jquery-oauth.git
</code></pre>

<p>... or by grabbing a zip of the latest release</p>

<h1>
<a id="usage" class="anchor" href="#usage" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Usage</h1>

<p>OAuth has to be implemented server side. If using Laravel, I recommend the great library
<a href="https://github.com/lucadegasperi/oauth2-server-laravel">oauth-server-laravel</a> by
<a href="https://github.com/lucadegasperi">Luca Degasperi</a> (<a href="https://twitter.com/lucadegasperi">@lucadegasperi</a>).</p>

<p>Have an endpoint that issues access tokens. Remember do NOT send <code>client_id</code> and <code>client_secret</code> with the request.
Send the request to a proxy endpoint that sends the request to the OAuth endpoint. Remember do NOT save the refresh
token client side. Save this as an encrypted httponly cookie and use a proxy to send this to the OAuth endpoint when
refreshing access tokens.</p>

<h2>
<a id="example-of-resource-owner-implementation-in-a-spa" class="anchor" href="#example-of-resource-owner-implementation-in-a-spa" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Example of resource owner implementation in a SPA</h2>

<h4>
<a id="somewhere-where-things-are-initialised" class="anchor" href="#somewhere-where-things-are-initialised" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Somewhere where things are initialised</h4>

<div class="highlight highlight-source-js"><pre><span class="pl-en">define</span>([<span class="pl-c">/*other dependencies,*/</span> <span class="pl-s"><span class="pl-pds">"</span>jquery-oauth<span class="pl-pds">"</span></span>, <span class="pl-k">function</span>(<span class="pl-smi">jqOAuth</span>){
    <span class="pl-c">/* other initialisation */</span>

    <span class="pl-k">var</span> csrfToken <span class="pl-k">=</span> <span class="pl-en">$</span>(<span class="pl-s"><span class="pl-pds">"</span>input[name='_token']<span class="pl-pds">"</span></span>).<span class="pl-en">val</span>();    

    <span class="pl-k">var</span> auth <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">jqOAuth</span>({
        csrfToken<span class="pl-k">:</span> csrfToken,
        events<span class="pl-k">:</span> {
            <span class="pl-en">login</span><span class="pl-k">:</span> <span class="pl-k">function</span>() {
                <span class="pl-c">// User is hereby logged in and the </span>
                <span class="pl-c">// access token will be added to subsequent</span>
                <span class="pl-c">// $.ajax calls, until a new token cannot </span>
                <span class="pl-c">// be acquired or auth.logout() is called.</span>
            },
            <span class="pl-en">logout</span><span class="pl-k">:</span> <span class="pl-k">function</span>() {
                <span class="pl-c">// auth.logout() has been called and the </span>
                <span class="pl-c">// authorization headers are removed from </span>
                <span class="pl-c">// $.ajaxSettings. Tokens are removed from</span>
                <span class="pl-c">// localStorage.</span>
            },
            <span class="pl-en">tokenExpiration</span><span class="pl-k">:</span> <span class="pl-k">function</span>() {
                <span class="pl-c">// this event is fired when 401 calls are </span>
                <span class="pl-c">// received from the server. Has to return </span>
                <span class="pl-c">// an ajax promise. </span>
                <span class="pl-c">// New tokens are set with auth.setAccessToken()</span>

                <span class="pl-k">return</span> <span class="pl-smi">$</span>.<span class="pl-en">post</span>(<span class="pl-s"><span class="pl-pds">"</span>/refresh-token-proxy-endpoint<span class="pl-pds">"</span></span>).<span class="pl-en">success</span>(<span class="pl-k">function</span>(<span class="pl-smi">response</span>){
                    <span class="pl-smi">auth</span>.<span class="pl-en">setAccessToken</span>(<span class="pl-smi">response</span>.<span class="pl-smi">accessToken</span>, <span class="pl-smi">response</span>.<span class="pl-smi">accessTokenExpiration</span>);
                });
            }
        }
    });
});</pre></div>

<h4>
<a id="login-form-when-form-is-submitted" class="anchor" href="#login-form-when-form-is-submitted" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Login form (when form is submitted)</h4>

<div class="highlight highlight-source-js"><pre><span class="pl-smi">$</span>.<span class="pl-en">ajax</span>({
   url<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>/access-token-proxy-endpoint<span class="pl-pds">"</span></span>,
   method<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>POST<span class="pl-pds">"</span></span>,
   data<span class="pl-k">:</span> {
       username<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>username-from-a-form<span class="pl-pds">"</span></span>,
       password<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>password-from-a-form<span class="pl-pds">"</span></span>
   },
   statusCode<span class="pl-k">:</span> {
       <span class="pl-c1">200</span><span class="pl-k">:</span> <span class="pl-k">function</span>(<span class="pl-smi">response</span>) {
           <span class="pl-smi">auth</span>.<span class="pl-en">login</span>(<span class="pl-smi">response</span>.<span class="pl-smi">accessToken</span>, <span class="pl-smi">response</span>.<span class="pl-smi">accessTokenExpiration</span>);
       },
       <span class="pl-c1">401</span><span class="pl-k">:</span> <span class="pl-k">function</span>() {
           <span class="pl-en">alert</span>(<span class="pl-s"><span class="pl-pds">"</span>The username or password were not correct. Try again.<span class="pl-pds">"</span></span>);
       }
   }
});</pre></div>

<h4>
<a id="logout" class="anchor" href="#logout" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Logout</h4>

<div class="highlight highlight-source-js"><pre><span class="pl-smi">auth</span>.<span class="pl-en">logout</span>();</pre></div>

<h1>
<a id="api" class="anchor" href="#api" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>API</h1>

<p>These calls are available through auth</p>

<div class="highlight highlight-source-js"><pre><span class="pl-en">define</span>([<span class="pl-s"><span class="pl-pds">'</span>jquery-oauth<span class="pl-pds">'</span></span>], <span class="pl-k">function</span>(<span class="pl-smi">auth</span>){
    <span class="pl-c">// The access token and expiration in seconds</span>
    <span class="pl-c">// Sets authorization headers and stores tokens</span>
    <span class="pl-smi">auth</span>.<span class="pl-en">login</span>(accessToken, accessTokenExpiration);

   <span class="pl-c">// Removes headers from $.ajax and tokens from localStorage</span>
   <span class="pl-smi">auth</span>.<span class="pl-en">logout</span>();

   <span class="pl-c">// Initialize library</span>
   <span class="pl-k">var</span> auth <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">jqOAuth</span>({
       csrfToken<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>token<span class="pl-pds">"</span></span> <span class="pl-c">//CSRF token,</span>
       events<span class="pl-k">:</span> {
           <span class="pl-en">logout</span><span class="pl-k">:</span> <span class="pl-k">function</span>(){},
           <span class="pl-en">login</span><span class="pl-k">:</span>  <span class="pl-k">function</span>(){},
           <span class="pl-en">tokenExpiration</span><span class="pl-k">:</span> <span class="pl-k">function</span>(){}
       }    
   });

   <span class="pl-c">// Sets new tokens - should be used with tokenExpiration event</span>
   <span class="pl-smi">auth</span>.<span class="pl-en">setAccessToken</span>(accessToken, accessTokenExpiration);

   <span class="pl-c">// Checks for tokens</span>
   <span class="pl-smi">auth</span>.<span class="pl-en">hasAccessToken</span>();
   <span class="pl-smi">auth</span>.<span class="pl-en">hasAccessTokenExpiration</span>();
});</pre></div>

<h1>
<a id="thank-you" class="anchor" href="#thank-you" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Thank you</h1>

<p>The library addresses OAuth problems in general. Many of these are outlined in this great article:
<a href="http://jeremymarc.github.io/2014/08/14/oauth2-with-angular-the-right-way/">OAuth2 with Angular the right way</a></p>

<p>Also, the refresh token functionality takes great inspiration in this great AngularJS library:
<a href="https://github.com/witoldsz/angular-http-auth">angular-http-auth</a></p>

<p>So thank you <a href="https://github.com/jeremymarc">Jeremy Marc</a> (<a href="https://twitter.com/jeremymarc">@jeremymarc</a>) and
<a href="https://github.com/witoldsz">Witold Szczerba</a> (<a href="https://twitter.com/witoldsz">@witoldsz</a>)</p>

<h1>
<a id="license" class="anchor" href="#license" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>License</h1>

<p>Copyright © 2015 <a href="http://github.com/esbenp">Esben Petersen</a> &amp; Contributors</p>

<p>Licensed under the Apache License, Version 2.0 (the "License"); you may not use this file except in compliance with
the License. You may obtain a copy of the License at: <a href="http://www.apache.org/licenses/LICENSE-2.0">http://www.apache.org/licenses/LICENSE-2.0</a></p>

<p>Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an
"AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the specific
language governing permissions and limitations under the License.</p>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/ettoavi/jQueryOAuth">JQueryOAuth</a> is maintained by <a href="https://github.com/ettoavi">ettoavi</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

  
  </body>
</html>
